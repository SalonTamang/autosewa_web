<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Autosewa</title>
    <link rel="stylesheet" href="css/style.css" />
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  </head>
  <body>
    <header>
      <nav>
        <!-- Navigation menu -->
        <div class="logoContainer">
          <!-- Logo -->
          <a href="index.html"
            ><img height="100%" width="80" src="images/logo.jpg" alt="logo"
          /></a>
        </div>
        <div class="contactContainer">
          <ul class="contactList">
            <li class="nav-link"><a href="#">About Us</a><span> |</span></li>
            <li class="nav-link"><a href="#">FAQs</a><span> |</span></li>
            <li class="nav-link"><a href="#">Contact </a></li>
          </ul>
          <div class="hamburger">
            <span class="bar"></span>
            <span class="bar"></span>
            <span class="bar"></span>
          </div>
        </div>
      </nav>
      <div class="banner">
        <h1>
          Get the nearest auto-driver <br />
          to pick you in minutes
        </h1>
        <h3>
          Free of service charge
          <p>Book any kind of rides</p>
        </h3>
      </div>
      <div class="content">
        <!-- Div with white background in the middle of the header section -->
        <!-- section for details -->
        <div class="details">
          <h2>How It Works</h2>
          <div class="infoContainer">
            <div class="info1">
              <div class="info-topic">
                <img src="images/1.png" alt="1" />
                <p>Select your city/town</p>
              </div>
              <img src="images/location.png" alt="User Location" />
              <p>
                Choose from a
                <span style="color: rgb(30, 229, 255)"
                  >wide range of cities</span
                >
                in Nepal
              </p>
            </div>
            <div class="info1">
              <div class="info-topic">
                <img src="images/2.png" alt="2" />
                <p>Choose your auto-rider</p>
              </div>
              <img src="images/choose.png" alt="Rider Selection" />
              <p>
                Then pick your favorite from
                <span style="color: rgb(30, 229, 255)"
                  >list of auto-riders</span
                >
              </p>
            </div>
            <div class="info1">
              <div class="info-topic">
                <img src="images/3.png" alt="3" />
                <p>Call the auto-rider</p>
              </div>
              <img src="images/call.png" alt="Call Rider" />
              <p>Discuss your pricing and details to get ride</p>
              <div></div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <main id="app" class="container">
      <section class="mainHeader">
        <center><h1>Pick your auto-driver</h1></center>
      </section>
      <section>
        <!-- Search functionality section -->
        <div class="search-container">
          <!-- <input type="text" placeholder="Search pick-up address" class="search-input"> -->
          <div class="search-function">
            <h3>Select your nearest auto station</h3>
            <center><select v-model="selectedStation" @change="sortStation" class="search-select"> 
              <option value="all" selected>{{ selectAllStation }}</option>
              <option v-for="station in stations" :value="station">{{ station }}</option>
            </select></center>
            <!-- <button v-on:click="sortStation" :disabled="selectedStation === null" class="search-button">Search</button> -->
          </div>
        </div>
      </section>
      <!-- Pagination section -->
      <section v-if="selectedStation !== null" class="pagination">
        <button class="previous btn" @click="prevPage" :disabled="page === 1">&laquo; Previous</button>
        <div style="flex: 1; text-align: center;" id="currentPage">{{ pageValue }} of {{ totalPages }} pages</div>
        <button class="next btn" @click="nextPage" :disabled="page === totalPages">Next &raquo;</button>
      </section>

      <section v-if="loading">
        <div class="loader"></div>
      </section>

      <section v-else class="driverContainer">
        <div class="driverList">
            <div v-for="item in paginatedDrivers" class='driver'>
              <div class='driver-image'>
                <img v-bind:src="item.image" alt='dimg' />
              </div>
              <div class='driver-info'>
                <h3>{{item.firstName}} {{item.lastName}}</h3>
                <a :href="'http://localhost:3000/profile.html?id=' + item.id">
                  <p>View info</p>
                </a>
                
              </div>
            </div>
        </div>
      </section>
    </main>

    <footer>
      <section>
        <div class="footer-main">
          <div class="first-section">
            <h3>autosewa</h3>
            <div class="outer-first">
              <div class="inner">
                <a href="#">About Us</a>
                <a href="#">FAQs</a>
                <a href="#">Contact</a>
                <a href=""></a>
              </div>
              <div class="inner">
                <a href="#">Terms&conditions</a>
                <a href="#">Privacy Policy</a>
                <a href="#">Cookie Policy</a>
              </div>
            </div>
            <!-- This section is for the social media links -->
            <div class="socialmedia-container">
              <a href="#"
                ><img
                  style="width: 45px; height: 40px"
                  src="https://th.bing.com/th/id/OIP.urCH_YGDAtkynJbQJ53JwAAAAA?rs=1&pid=ImgDetMain"
                  alt="facebook"
              /></a>
              <a href="#"
                ><img
                  style="width: 45px; height: 40px"
                  src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a5/Instagram_icon.png/2048px-Instagram_icon.png"
                  alt="instagram"
              /></a>
              <a href="#"
                ><img
                  style="width: 45px; height: 40px; border-radius: 5px"
                  src="https://cdn2.iconfinder.com/data/icons/metro-ui-dock/512/Twitter_NEW.png"
                  alt="twitter"
              /></a>
            </div>
          </div>
          <div class="second-section">
            <div class="second-inner">

                <h3>Get the latest updates</h3>
                <div style="margin: 7px 0px">
                    <input type="email" placeholder="Enter your email address" />
                    <button>Subscribe</button>
                </div>
                <div>
                    <input type="checkbox" />
                    <label
                    >By checking the box, you agree to the terms and
                    conditions</label
                    >
                </div>
            </div>
                <div style="width: 50px; height: 100%; display: flex; justify-content: center;">
                    <!-- Go To Top button -->
              <button onclick="topFunction()" id="goToTop" title="Go to top">
                <img src="images/up.png" height="15" width="15" alt="up" />
              </button>
            </div>
          </div>
        </div>
      </section>
    </footer>

    
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script> !

    <script>

    //  let allRiders = [];

    //  function loadData(){
    //     fetch("http://localhost:3000/getAllDrivers")
    //     .then(data => data.json())
    //     .then(data=> allRiders = data)
    //   }

    //   window.onload = loadData();

    new Vue({
        el: '#app',
        data: {
          allDrivers:[],  
          sortedDrivers:[],
          selectedStation: null,
          stations:['Chauda', 'Karra', 'Padam Pokhari', 'Buddha chowk', 'Kamane'],
          page: 1,
          itemsPerPage: 15,
          loading: false,
        },
        methods: {
          fetchData() {
            axios.get(`http://localhost:3000/getAllDrivers`)
              .then(response => {
                this.allDrivers = response.data;
                this.page = 1;
              })
              
              .catch(error => {
                console.error('Error:', error);
              });
              
          },
          nextPage() {
            if (this.page < this.totalPages) {
              this.page++;
            }
          },
          prevPage() {
            if (this.page > 1) {
              this.page--;
            }
          },
          sortStation: function() {
            this.page = 1;
            this.loading = true;

             // simulate async operation
            setTimeout(() => {
              this.loading = false;
            }, 1000);

            var station = this.selectedStation.toLowerCase(); 
            if(station === "all"){ 
              this.sortedDrivers = this.allDrivers;
            } else {
              this.sortedDrivers = this.allDrivers.filter(item => item.station === station);
            }
          },
        },
        computed: {
          selectAllStation: function() {
            return "All";
          },
          
          paginatedDrivers() {
            if (this.sortedDrivers.length === 0) {
              this.page = 0;
            } 
            const start = (this.page - 1) * this.itemsPerPage;
            const end = start + this.itemsPerPage;
            if(this.selectedStation === null){
              return this.allDrivers.slice(start, end);
            } else{
              return this.sortedDrivers.slice(start, end);
            } 
          },
          totalPages() {
            return Math.ceil(this.sortedDrivers.length / this.itemsPerPage);
          },
          pageValue() {
            if(this.totalPages === 0){
              this.page = 0;  
            }
            return this.page;
          }
        },
        created() {
          this.fetchData();
        },
    });

    
    
  
      const hamburger = document.querySelector(".hamburger");
      const navLinks = document.querySelector(".contactList");
      const links = document.querySelectorAll(".contactList li");

      hamburger.addEventListener("click", mobileMenu);

      function mobileMenu() {
        hamburger.classList.toggle("active");
        navLinks.classList.toggle("active");
      }
      const navLink = document.querySelectorAll(".nav-link");

      navLink.forEach((n) => n.addEventListener("click", closeMenu));

      function closeMenu() {
        hamburger.classList.remove("active");
        navLinks.classList.remove("active");
      }

      // Get the button
      let goToTop = document.getElementById("goToTop");

      // When the user scrolls down 20px from the top of the document, show the button
      window.onscroll = function () {
        scrollFunction();
      };

      function scrollFunction() {
        if (
          document.body.scrollTop > 20 ||
          document.documentElement.scrollTop > 20
        ) {
          goToTop.style.display = "block";
        } else {
          goToTop.style.display = "none";
        }
      }

      // When the user clicks on the button, scroll to the top of the document
      function topFunction() {
          document.body.scrollTop = 0;
          document.documentElement.scrollTop = 0;
      } 

      // // Handling pagination
      // function changePage(action){

      //   // Get the select element
      //   var selectElement = document.querySelector('.search-select');
      //   var searchData = selectElement.value || "all";
      //   // retrieving the current page
      //   var currentPageElem = document.getElementById("currentPage");
      //   let page = parseInt(currentPageElem.innerHTML);

      //   if(action === "Previous" && page === 1){
      //       return;
      //   }

      //   if(action === "Next"){
      //      page = page + 1;
      //   }
      //   else if(action === "Previous"){
      //     page = page - 1;
      //   }

      //   currentPageElem.innerHTML = page;
      //   window.location.href = `http://localhost:3000/getDrivers?station=${searchData}&page=${page}`
      // }

      // //search the drivers based on location

      

      // function searchDrivers() {
      //   // Get the select element
      //   var selectElement = document.querySelector('.search-select');
      //   var searchData = selectElement.value;

      //   fetch("http://localhost:3000/getDrivers?station=" + searchData)
      //     .then(response => response.json())
      //     .then(data => {
      //       const driverList = document.querySelector(".driverList");
      //       driverList.innerHTML = data.map(driver => `
      //         <div class='driver'>
      //           <div class='driver-image'>
      //             <img src="${driver.image}" alt='dimg' />
      //           </div>
      //           <div class='driver-info'>
      //             <h3>${driver.firstName} ${driver.lastName}</h3>
      //             <a href="localhost:3000?id=${driver.id}"><p>View info</p></a>
      //           </div>
      //         </div>
      //       `).join('');
      //     })
      //     .catch(error => console.error('Error:', error));
      // }

      
      // const search_button = document.querySelector(".search-button");
      // search_button.addEventListener("click", searchDrivers);

    </script>
  </body>
</html>
